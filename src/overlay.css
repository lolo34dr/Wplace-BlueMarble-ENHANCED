/* ===========================
   Blue Marble Overlay — style amélioré
   Version : améliorée pour modernité, accessibilité et cohérence visuelle
   =========================== */

/* Variables globales — personnalise ici */
:root{
  --bm-primary: #144eb9;           /* couleur principale boutons */
  --bm-primary-strong: #1061e5;
  --bm-accent: #2e97ff;            /* accent/dominant */
  --bm-bg: rgba(12,18,40,0.72);    /* overlay background (glass) */
  --bm-border: rgba(255,255,255,0.06);
  --bm-muted: rgba(255,255,255,0.65);
  --bm-muted-2: rgba(255,255,255,0.45);
  --bm-radius: 10px;
  --bm-shadow: 0 10px 30px rgba(2,8,23,0.6);
  --bm-ui-gap: 0.6rem;
  --bm-maxw: 320px;
  --bm-minw: 200px;
}

/* Base — overlay principal */
#bm-overlay, #bm-overlay-telemetry {
  position: fixed;
  right: 1rem;
  bottom: 1rem;
  max-width: var(--bm-maxw);
  min-width: var(--bm-minw);
  width: auto;
  padding: 12px;
  border-radius: var(--bm-radius);
  color: white;
  z-index: 9000;
  font-family: 'Roboto Mono', 'Courier New', Monaco, 'DejaVu Sans Mono', monospace, Arial;
  letter-spacing: 0.04em;
  background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
  backdrop-filter: blur(8px) saturate(110%);
  background-color: var(--bm-bg);
  border: 1px solid var(--bm-border);
  box-shadow: var(--bm-shadow);
  transition: transform 220ms cubic-bezier(.2,.9,.3,1), opacity 160ms ease, box-shadow 160ms ease;
  will-change: transform, opacity;
  -webkit-backface-visibility: hidden;
  transform-style: preserve-3d;
  -webkit-transform-style: preserve-3d;
  overflow: hidden;
}

/* Responsive small screens */
@media (max-width: 420px){
  #bm-overlay, #bm-overlay-telemetry {
    left: 0.6rem;
    right: 0.6rem;
    bottom: 0.6rem;
    max-width: calc(100% - 1.2rem);
  }
}

/* Smooth transitions for internal containers */
#bm-contain-userinfo,
#bm-overlay hr, #bm-overlay-telemetry hr,
#bm-contain-automation,
#bm-contain-buttons-action {
  transition: opacity 180ms ease, height 180ms ease, margin 180ms ease;
}

/* Drag bar — plus visible et tactile */
#bm-bar-drag, #bm-bar-drag-telemetry {
  display: flex;
  align-items: center;
  gap: 0.6ch;
  cursor: grab;
  width: 100%;
  height: 1.2em;
  margin-bottom: 0.5rem;
  padding: 4px 6px;
  border-radius: 8px;
  background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="6" height="6"><circle cx="3" cy="3" r="1.25" fill="%23ffffff33" /></svg>');
  background-repeat: repeat;
  opacity: 0.95;
  user-select: none;
}

/* Dragging state */
#bm-bar-drag.dragging, #bm-bar-drag-telemetry.dragging {
  cursor: grabbing;
  filter: brightness(0.98);
}

/* While overlay dragging, disable interactions (keep dragbar active) */
#bm-overlay:has(#bm-bar-drag.dragging), #bm-overlay-telemetry:has(#bm-bar-drag-telemetry.dragging) {
  pointer-events: none;
  user-select: none;
}
#bm-bar-drag.dragging, #bm-bar-drag-telemetry.dragging { pointer-events: auto; }

/* Header layout */
#bm-contain-header, #bm-contain-header-telemetry {
  display: flex;
  align-items: center;
  gap: 0.6rem;
  margin-bottom: 0.35rem;
}

/* Centered/minimized header compatibility: conserve les sélecteurs inline existants + une classe plus pratique */
#bm-contain-header[style*="text-align: center"],
#bm-contain-header-telemetry[style*="text-align: center"],
#bm-contain-header.minimized, #bm-contain-header-telemetry.minimized {
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

/* Logo / image */
#bm-overlay img {
  display: inline-block;
  height: 2.6em;
  width: 2.6em;
  object-fit: cover;
  border-radius: 8px;
  margin-right: 0.8ch;
  vertical-align: middle;
  transition: opacity 160ms ease, transform 200ms ease;
  box-shadow: 0 4px 14px rgba(2,8,23,0.45), inset 0 1px 0 rgba(255,255,255,0.02);
}

/* centered image when minimized */
#bm-contain-header[style*="text-align: center"] img,
#bm-contain-header.minimized img { margin: 0; display:block; }

/* Title */
#bm-overlay h1, #bm-overlay-telemetry h1 {
  margin: 0;
  font-size: 1.05rem;
  line-height: 1;
  font-weight: 700;
  color: white;
  text-shadow: 0 1px 0 rgba(0,0,0,0.45);
}

/* Subtext small */
#bm-overlay small { color: var(--bm-muted-2); font-size: 0.72rem; display:block; margin-top: 2px; }

/* Containers spacing */
#bm-contain-userinfo,
#bm-contain-automation,
#bm-contain-coords,
#bm-contain-buttons-template,
div:has(> #bm-input-file-template),
#bm-output-status { margin-top: var(--bm-ui-gap); }

/* Automation checkboxes */
#bm-contain-automation input[type="checkbox"] {
  vertical-align: middle;
  margin-right: 0.6ch;
  width: 1.05em;
  height: 1.05em;
  accent-color: var(--bm-primary);
}
#bm-contain-automation label { margin-right: 0.5ch; color: var(--bm-muted); }

/* Buttons — modernes et accessibles */
#bm-overlay button, #bm-overlay-telemetry button {
  display: inline-flex;
  align-items: center;
  gap: 0.5ch;
  justify-content: center;
  min-height: 2rem;
  padding: 6px 10px;
  border-radius: 999px;
  border: none;
  background-color: var(--bm-primary);
  color: white;
  font-weight: 600;
  cursor: pointer;
  transition: transform 140ms ease, box-shadow 140ms ease, background-color 120ms ease;
  box-shadow: 0 6px 18px rgba(16,97,229,0.12);
  user-select: none;
}

/* Hover / focus */
#bm-overlay button:hover, #bm-overlay-telemetry button:hover,
#bm-overlay button:focus-visible, #bm-overlay-telemetry button:focus-visible {
  transform: translateY(-2px);
  background-color: var(--bm-primary-strong);
  outline: none;
  box-shadow: 0 10px 28px rgba(16,97,229,0.18);
  border: 1px solid rgba(255,255,255,0.04);
}

/* Active */
#bm-overlay button:active, #bm-overlay-telemetry button:active {
  transform: translateY(0);
  box-shadow: 0 4px 12px rgba(2,8,23,0.35);
  background-color: var(--bm-accent);
}

/* Disabled — plus discret (évite line-through) */
#bm-overlay button:disabled, #bm-overlay-telemetry button:disabled {
  opacity: 0.45;
  filter: grayscale(0.25);
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}

/* Help (bouton '?') */
.bm-help {
  height: 1.6em;
  width: 1.6em;
  border-radius: 50%;
  border: 1px solid rgba(255,255,255,0.12);
  background: rgba(255,255,255,0.06);
  color: white;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 0.85rem;
  padding: 0;
  line-height: 1;
  transition: transform 120ms ease, background 120ms ease;
}
.bm-help:hover { transform: translateY(-2px); background: rgba(255,255,255,0.08); }

/* Pin button & icons — utilise currentColor pour faciliter le theming */
#bm-button-coords { vertical-align: middle; display:inline-flex; align-items:center; }
#bm-button-coords svg { width: 1.1em; height: 1.1em; fill: currentColor; }

/* Favorite / template icons */
#bm-button-favorite svg, #bm-button-template svg {
  height: 1.05em;
  vertical-align: middle;
  margin-top: 2px;
}

/* Inputs (coords) */
#bm-contain-coords input[type="number"] {
  -moz-appearance: textfield;
  appearance: textfield;
  width: 5.5ch;
  margin-left: 0.6ch;
  background-color: rgba(255,255,255,0.03);
  padding: 0.2rem 0.4rem;
  border-radius: 6px;
  border: 1px solid rgba(255,255,255,0.03);
  font-size: 0.85rem;
  color: white;
  transition: box-shadow 120ms ease, border-color 120ms ease;
}
#bm-contain-coords input[type="number"]:focus {
  outline: none;
  box-shadow: 0 6px 16px rgba(16,97,229,0.12);
  border-color: rgba(46,151,255,0.45);
}

/* Remove default spinners (WebKit) */
#bm-contain-coords input[type="number"]::-webkit-outer-spin-button,
#bm-contain-coords input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }

/* File input wrapper (upload button) */
div:has(> #bm-input-file-template) > button {
  width: 100%;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Force invisible file input (keeps ton approche) */
#bm-input-file-template,
input[type="file"][id*="template"] {
  position: absolute !important;
  left: -9999px !important;
  top: -9999px !important;
  width: 0 !important;
  height: 0 !important;
  opacity: 0 !important;
  pointer-events: none !important;
}

/* Output status area */
#bm-output-status {
  font-size: 0.78rem;
  background-color: rgba(255,255,255,0.02);
  padding: 0.45rem 0.6rem;
  height: 3.8em;
  width: 100%;
  border-radius: 8px;
  overflow-y: auto;
  color: var(--bm-muted);
  border: 1px solid rgba(255,255,255,0.02);
}

/* Action buttons container */
#bm-contain-buttons-action {
  display: flex;
  gap: 0.6rem;
  justify-content: space-between;
  align-items: center;
}

/* Template buttons container */
#bm-contain-buttons-template {
  display: flex;
  flex-wrap: wrap;
  gap: 0.6rem;
  justify-content: center;
}

/* Borders / separators */
#bm-overlay hr, #bm-overlay-telemetry hr { border: 0; height: 1px; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.03), transparent); margin: 0.6rem 0; }

/* Minimized / compact mode helpers */
/* On certains code existants tu utilises inline style padding:5px — on prend aussi en compte class .compact/.minimized */
#bm-overlay[style*="padding: 5px"],
#bm-overlay-telemetry[style*="padding: 5px"],
#bm-overlay.compact, #bm-overlay.minimized,
#bm-overlay-telemetry.compact, #bm-overlay-telemetry.minimized {
  padding: 6px;
  width: auto !important;
  max-width: var(--bm-maxw);
  min-width: var(--bm-minw);
  border-radius: 8px;
}

/* Focus outlines accessibles pour keyboard navigation */
#bm-overlay button:focus-visible, #bm-overlay-telemetry button:focus-visible {
  box-shadow: 0 0 0 3px rgba(46,151,255,0.14), 0 8px 20px rgba(2,8,23,0.45);
}

/* Tiny UX polish: subtle hover on the whole overlay gives lift */
#bm-overlay:hover, #bm-overlay-telemetry:hover {
  transform: translateY(-4px);
}

/* Accessibility: high-contrast fallback when user prefers it */
@media (prefers-contrast: high){
  #bm-overlay, #bm-overlay-telemetry { border-color: rgba(255,255,255,0.14); box-shadow: 0 12px 30px rgba(0,0,0,0.75); }
}

/* Keep previous monospace styling for small inline elements */
#bm-overlay small { font-family: inherit; }

/* Fin */
