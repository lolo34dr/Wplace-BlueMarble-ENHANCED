/*
  bm-overlay-improved.css
  Amélioration du rendu et du style pour l'overlay "Blue Marble"
  - Variables pour thèmes
  - Meilleure accessibilité (contraste, focus-visible)
  - Transitions plus fluides et respect du prefers-reduced-motion
  - Performances : transform hardware-accelerated, will-change minimal
  - Styles de boutons et inputs améliorés
  - Compatibilité et fallback pour sélecteurs modernes
  
  Version: 0.5.2-improved
*/

:root{
  /* palette */
  --bm-bg: rgba(16,30,70,0.92);            /* fond principal */
  --bm-accent: #1e6ef4;                    /* couleur principale (boutons) */
  --bm-accent-strong: #0f5be0;
  --bm-glass: rgba(255,255,255,0.04);      /* léger effet verre */
  --bm-muted: rgba(255,255,255,0.6);       /* texte secondaire */
  --bm-muted-2: rgba(255,255,255,0.45);
  --bm-border: rgba(255,255,255,0.08);
  --bm-radius: 12px;
  --bm-padding: 12px;
  --bm-shadow: 0 8px 24px rgba(2,6,23,0.55);
  --bm-font-mono: 'Roboto Mono', 'Courier New', Monaco, 'DejaVu Sans Mono', monospace;
  --bm-gap: 0.6ch;
}

/* Respecter les préférences d'animation */
@media (prefers-reduced-motion: reduce) {
  :root { --bm-transition-time: 0.0s; }
}
@media (prefers-reduced-motion: no-preference){
  :root { --bm-transition-time: 0.22s; }
}

/* Base du overlay */
#bm-overlay, #bm-overlay-telemetry {
  position: fixed;
  right: 1rem;
  bottom: 1rem;
  background-color: var(--bm-bg);
  color: #ffffff;
  padding: var(--bm-padding);
  border-radius: var(--bm-radius);
  z-index: 9000;
  transition: transform var(--bm-transition-time) ease, opacity var(--bm-transition-time) ease, box-shadow var(--bm-transition-time);
  max-width: 340px;
  width: min(92vw, 320px);
  box-shadow: var(--bm-shadow);
  backdrop-filter: blur(6px) saturate(120%);
  -webkit-backdrop-filter: blur(6px) saturate(120%);
  will-change: transform;
  transform: translateZ(0);
  font-family: var(--bm-font-mono);
  letter-spacing: 0.04em;
  user-select: none;
  outline: none;
}

/* Compact / minimized state (helper class to toggle from JS) */
#bm-overlay.minimized, #bm-overlay-telemetry.minimized{
  width: auto;
  max-width: 240px;
  padding: 8px;
  border-radius: 10px;
}

/* Header / drag bar */
#bm-bar-drag, #bm-bar-drag-telemetry{
  display: block;
  cursor: grab;
  height: 1.2rem;
  margin-bottom: 0.6rem;
  border-radius: 6px;
  background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='6' height='6'><circle cx='3' cy='3' r='1.5' fill='%23A6C8FF' opacity='0.15'/></svg>");
  background-repeat: repeat;
  background-size: 6px 6px;
  transition: box-shadow var(--bm-transition-time) ease, transform 0.05s linear;
}
#bm-bar-drag.dragging, #bm-bar-drag-telemetry.dragging{
  cursor: grabbing;
  transform: translate3d(0,0,0);
}

/* While dragging, disable pointer-events on contents for performance */
#bm-overlay.dragging, #bm-overlay-telemetry.dragging{
  pointer-events: none;
}
#bm-overlay.dragging *:not(#bm-bar-drag):not(#bm-bar-drag-telemetry),
#bm-overlay-telemetry.dragging *:not(#bm-bar-drag):not(#bm-bar-drag-telemetry){
  pointer-events: none;
}

/* Header content */
#bm-contain-header, #bm-contain-header-telemetry{
  display: flex;
  align-items: center;
  gap: 0.6ch;
  margin-bottom: 0.5rem;
}
#bm-contain-header img, #bm-contain-header-telemetry img{
  height: 2.4rem;
  width: auto;
  display: inline-block;
  vertical-align: middle;
  border-radius: 6px;
  background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0));
  transition: opacity var(--bm-transition-time) ease, transform 120ms;
}
#bm-contain-header.minified img{ height: 2rem; }
#bm-overlay h1, #bm-overlay-telemetry h1{
  font-size: clamp(1rem, 1.6vw, 1.1rem);
  margin: 0;
  font-weight: 700;
  letter-spacing: 0.02em;
}

/* Flexible centered header (useful when minimized) */
#bm-contain-header.centered, #bm-contain-header-telemetry.centered{
  display:flex; flex-direction:column; align-items:center; text-align:center; gap:0.2rem;
}

/* Containers spacing */
#bm-contain-userinfo, #bm-contain-automation, #bm-contain-coords, #bm-contain-buttons-template, #bm-output-status{
  margin-top: 0.6rem;
}

/* Automation checkboxes */
#bm-contain-automation label{ display:inline-flex; align-items:center; gap:0.5ch; color:var(--bm-muted); font-size:0.9rem; }
#bm-contain-automation input[type="checkbox"]{ width:1.05rem; height:1.05rem; accent-color: var(--bm-accent); }

/* Coords inputs */
#bm-contain-coords input[type="number"]{
  -moz-appearance: textfield;
  -webkit-appearance: none;
  appearance: textfield;
  width: 6ch;
  min-width: 4ch;
  padding: 0.25rem 0.4rem;
  background: rgba(255,255,255,0.03);
  border: 1px solid var(--bm-border);
  border-radius: 6px;
  color: #fff;
  font-size: 0.9rem;
}
#bm-contain-coords input[type="number"]:focus{ outline: 2px solid rgba(30,110,244,0.18); }
#bm-contain-coords input[type="number"]::-webkit-outer-spin-button,
#bm-contain-coords input[type="number"]::-webkit-inner-spin-button{ -webkit-appearance: none; margin: 0; }

/* Buttons area */
#bm-contain-buttons-template{ display:flex; gap:0.6ch; flex-wrap:wrap; justify-content:center; align-items:center; }
#bm-contain-buttons-action{ display:flex; justify-content:space-between; gap:0.5rem; }

/* Generic button style */
#bm-overlay button, #bm-overlay-telemetry button{
  background-color: var(--bm-accent);
  color: white;
  border: none;
  border-radius: 999px;
  padding: 6px 10px;
  font-size: 0.95rem;
  cursor: pointer;
  box-shadow: 0 3px 8px rgba(8,25,64,0.45);
  transition: transform 120ms ease, background-color var(--bm-transition-time) ease, box-shadow var(--bm-transition-time) ease;
  display:inline-flex; align-items:center; gap:0.5ch;
}
#bm-overlay button:hover, #bm-overlay button:focus-visible, #bm-overlay-telemetry button:hover, #bm-overlay-telemetry button:focus-visible{
  background-color: var(--bm-accent-strong);
  transform: translateY(-1px);
}
#bm-overlay button:active, #bm-overlay-telemetry button:active{
  transform: translateY(0);
}
#bm-overlay button:disabled, #bm-overlay-telemetry button:disabled{
  background-color: rgba(255,255,255,0.08);
  color: rgba(255,255,255,0.5);
  cursor: not-allowed;
  text-decoration: none;
  box-shadow: none;
}

/* Small icon-like buttons (help, pin, star) */
.bm-help, #bm-button-coords{ width:1.5rem; height:1.5rem; padding:0; border-radius:6px; display:inline-grid; place-items:center; background:var(--bm-glass); border:1px solid var(--bm-border); }
.bm-help:hover{ transform: scale(1.03); }
#bm-button-coords svg{ width:60%; height:60%; display:block; fill: currentColor; color:#07122b; }
#bm-button-favorite svg, #bm-button-template svg{ height:1.05rem; vertical-align:middle; }

/* File input hack: keep the input visually hidden but keyboard accessible via label */
#bm-input-file-template{ position:absolute; left:-9999px; top:auto; width:1px; height:1px; overflow:hidden; }
div:has(> #bm-input-file-template) > button{ width:100%; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

/* Status box */
#bm-output-status{
  font-size: 0.86rem;
  background: rgba(0,0,0,0.15);
  padding: 0.5rem;
  border-radius: 8px;
  min-height: 3.75rem;
  color: var(--bm-muted-2);
  overflow:auto;
}

/* Small text */
#bm-overlay small{ font-size:0.75rem; color:var(--bm-muted-2); }

/* HR smoothing and small separators */
#bm-overlay hr, #bm-overlay-telemetry hr{ height:1px; border:0; background: linear-gradient(90deg, transparent, var(--bm-border), transparent); margin:0.6rem 0; }

/* Accessibility focus outline */
:focus-visible{ outline: 3px solid rgba(30,110,244,0.18); outline-offset: 3px; border-radius: 8px; }

/* Utility: make the overlay more responsive on very small screens */
@media (max-width: 420px){
  #bm-overlay, #bm-overlay-telemetry{ right:0.6rem; left:0.6rem; bottom:0.8rem; width: calc(100% - 1.2rem); max-width: none; }
  #bm-contain-header img{ height:2.1rem; }
  #bm-overlay h1{ font-size:1rem; }
}

/* Printing fallback: hide overlay */
@media print{ #bm-overlay, #bm-overlay-telemetry{ display:none !important; } }

/* Fallbacks & notes:
   - The :has() selector is powerful but not supported in older browsers. The file input and some layout utilities rely on it; if you must support legacy browsers, add explicit classes from JS instead.
   - Use JS to toggle the classes: .dragging, .minimized, .centered, .dragging on root overlay etc.
*/
